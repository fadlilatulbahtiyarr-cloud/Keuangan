<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan Sat-Set</title>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animasi halus */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Efek tekan tombol kalkulator */
        .numpad-btn:active {
            transform: scale(0.95);
            background-color: #e5e7eb;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Ikon SVG Inline ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            Wallet: (props) => <Icon {...props} path={<><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4" /><path d="M3 5v14a2 2 0 0 0 2 2h16v-5" /><path d="M18 12a2 2 0 0 0 0 4h4v-4Z" /></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>} />,
            TrendingUp: (props) => <Icon {...props} path={<><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></>} />,
            TrendingDown: (props) => <Icon {...props} path={<><polyline points="22 17 13.5 8.5 8.5 13.5 2 7" /><polyline points="16 17 22 17 22 11" /></>} />,
            Save: (props) => <Icon {...props} path={<><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-8H7v8"/><path d="M7 3v5h8"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            Utensils: (props) => <Icon {...props} path={<><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></>} />,
            Coffee: (props) => <Icon {...props} path={<><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></>} />,
            ShoppingBag: (props) => <Icon {...props} path={<><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><line x1="3" x2="21" y1="6" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></>} />,
            PenTool: (props) => <Icon {...props} path={<><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></>} />,
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
            Delete: (props) => <Icon {...props} path={<><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/><line x1="18" x2="12" y1="9" y2="15"/><line x1="12" x2="18" y1="9" y2="15"/></>} />
        };

        function App() {
            // --- State ---
            const [transactions, setTransactions] = useState(() => {
                const saved = localStorage.getItem('keuangan_data');
                return saved ? JSON.parse(saved) : [];
            });
            
            const [inputAmount, setInputAmount] = useState(""); // Disimpan sebagai string "12000"
            const [inputType, setInputType] = useState("pengeluaran");
            const [selectedCategory, setSelectedCategory] = useState("Makanan");
            const [note, setNote] = useState("");
            const [atkItem, setAtkItem] = useState("");
            const [showNumpad, setShowNumpad] = useState(true); // Toggle numpad vs history
            
            // --- Kategori Data ---
            const categories = [
                { id: 'Makanan', icon: <Icons.Utensils size={18} />, color: 'bg-orange-100 text-orange-600' },
                { id: 'Minuman', icon: <Icons.Coffee size={18} />, color: 'bg-blue-100 text-blue-600' },
                { id: 'Snack', icon: <Icons.ShoppingBag size={18} />, color: 'bg-yellow-100 text-yellow-600' },
                { id: 'ATK', icon: <Icons.PenTool size={18} />, color: 'bg-purple-100 text-purple-600' },
                { id: 'Lainnya', icon: <Icons.BookOpen size={18} />, color: 'bg-gray-100 text-gray-600' },
            ];

            const atkOptions = ["Pulpen", "Pensil", "Spidol", "Penghapus", "Penggaris", "Buku"];

            // --- Efek Penyimpanan ---
            useEffect(() => {
                localStorage.setItem('keuangan_data', JSON.stringify(transactions));
            }, [transactions]);

            // --- Helper Functions ---
            const formatRupiah = (number) => {
                return new Intl.NumberFormat("id-ID", {
                    style: "currency",
                    currency: "IDR",
                    minimumFractionDigits: 0
                }).format(number);
            };
            
            // Format angka saat diketik (hanya visual angka + titik)
            const formatInputDisplay = (val) => {
                if (!val) return "0";
                return parseInt(val).toLocaleString('id-ID');
            };

            // --- Logic Numpad ---
            const handleNumpadClick = (value) => {
                if (inputAmount.length > 12) return; // Limit digit
                if (value === '0' || value === '00' || value === '000') {
                    if (!inputAmount) return; // Jangan tambah 0 di awal
                }
                setInputAmount(prev => prev + value);
            };

            const handleBackspace = () => {
                setInputAmount(prev => prev.slice(0, -1));
            };

            const handleClear = () => {
                setInputAmount("");
            };

            const handleSave = () => {
                if (!inputAmount || parseInt(inputAmount) === 0) {
                    alert("Nominal belum diisi!");
                    return;
                }

                const finalNote = selectedCategory === 'ATK' && atkItem 
                    ? `ATK: ${atkItem} ${note ? `(${note})` : ''}` 
                    : note || selectedCategory;

                const newTransaction = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    type: inputType,
                    amount: parseInt(inputAmount),
                    category: selectedCategory,
                    note: finalNote
                };

                setTransactions([newTransaction, ...transactions]);
                
                // Reset Form
                setInputAmount("");
                setNote("");
                setAtkItem("");
                alert("Berhasil disimpan!");
            };

            const handleDelete = (id) => {
                if(confirm("Hapus data ini?")) {
                    setTransactions(transactions.filter(t => t.id !== id));
                }
            };

            const exportToCSV = () => {
                const headers = ["Tanggal", "Jam", "Tipe", "Kategori", "Catatan", "Jumlah"];
                const rows = transactions.map(t => {
                    const d = new Date(t.date);
                    return [
                        d.toLocaleDateString('id-ID'),
                        d.toLocaleTimeString('id-ID'),
                        t.type,
                        t.category,
                        `"${t.note}"`,
                        t.amount
                    ];
                });

                let csvContent = "data:text/csv;charset=utf-8," 
                    + headers.join(",") + "\n" 
                    + rows.map(e => e.join(",")).join("\n");

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `Rekap_Keuangan_${new Date().toLocaleDateString('id-ID')}.csv`);
                document.body.appendChild(link);
                link.click();
            };

            // --- Stats ---
            const stats = useMemo(() => {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();

                const filtered = transactions.filter(t => {
                    const d = new Date(t.date);
                    return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
                });

                const income = filtered.filter(t => t.type === 'pemasukan').reduce((acc, curr) => acc + curr.amount, 0);
                const expense = filtered.filter(t => t.type === 'pengeluaran').reduce((acc, curr) => acc + curr.amount, 0);

                return { income, expense, balance: income - expense };
            }, [transactions]);

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen shadow-xl relative pb-10 flex flex-col">
                    {/* Sticky Header */}
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-700 p-5 text-white shadow-lg sticky top-0 z-50">
                        <div className="flex justify-between items-center mb-2">
                            <h1 className="text-lg font-bold flex items-center gap-2">
                                <Icons.Wallet size={20} className="text-yellow-300"/> Dompet Sat-Set
                            </h1>
                            <button onClick={exportToCSV} className="bg-white/20 p-1.5 rounded-full hover:bg-white/30 backdrop-blur-sm transition-all" title="Download Excel/CSV">
                                <Icons.Download size={18} />
                            </button>
                        </div>
                        <div className="flex justify-between items-end">
                            <div>
                                <p className="text-xs text-blue-100">Sisa Saldo</p>
                                <p className="text-xl font-bold">{formatRupiah(stats.balance)}</p>
                            </div>
                            <div className="text-right text-xs">
                                <p className="text-green-300">Masuk: {formatRupiah(stats.income)}</p>
                                <p className="text-red-300">Keluar: {formatRupiah(stats.expense)}</p>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto no-scrollbar">
                        {/* Area Input & Kalkulator */}
                        <div className="p-4 pb-0">
                            {/* Switch Type */}
                            <div className="flex gap-2 mb-3 bg-gray-100 p-1 rounded-lg">
                                <button 
                                    onClick={() => setInputType('pengeluaran')}
                                    className={`flex-1 py-1.5 text-sm font-semibold rounded-md transition-all ${inputType === 'pengeluaran' ? 'bg-white text-red-600 shadow-sm' : 'text-gray-500'}`}
                                >
                                    Pengeluaran
                                </button>
                                <button 
                                    onClick={() => setInputType('pemasukan')}
                                    className={`flex-1 py-1.5 text-sm font-semibold rounded-md transition-all ${inputType === 'pemasukan' ? 'bg-white text-green-600 shadow-sm' : 'text-gray-500'}`}
                                >
                                    Pemasukan
                                </button>
                            </div>

                            {/* Layar Kalkulator */}
                            <div className="bg-white border-2 border-gray-200 rounded-xl p-4 mb-3 text-right flex flex-col justify-center h-20 shadow-inner relative overflow-hidden">
                                <span className="text-xs text-gray-400 font-bold absolute top-2 left-3">NOMINAL (RP)</span>
                                <div className={`text-3xl font-bold tracking-tight ${inputType === 'pemasukan' ? 'text-green-600' : 'text-gray-800'}`}>
                                    {formatInputDisplay(inputAmount)}
                                </div>
                            </div>

                            {/* Kategori */}
                            <div className="mb-3">
                                <div className="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                                    {categories.map(cat => (
                                        <button
                                            key={cat.id}
                                            onClick={() => setSelectedCategory(cat.id)}
                                            className={`flex flex-col items-center justify-center min-w-[60px] h-[60px] rounded-xl border transition-all ${selectedCategory === cat.id ? 'border-indigo-500 bg-indigo-50 ring-1 ring-indigo-500' : 'border-gray-100 bg-white'}`}
                                        >
                                            <div className={`${cat.color} p-1.5 rounded-full`}>{cat.icon}</div>
                                            <span className="text-[10px] font-medium mt-1">{cat.id}</span>
                                        </button>
                                    ))}
                                </div>
                                {selectedCategory === 'ATK' && (
                                    <div className="grid grid-cols-3 gap-2 animate-fade-in mt-1">
                                        {atkOptions.map(opt => (
                                            <button key={opt} onClick={() => setAtkItem(opt)} className={`text-xs py-1 rounded border ${atkItem === opt ? 'bg-purple-600 text-white' : 'bg-white text-gray-600'}`}>{opt}</button>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Catatan */}
                            <input 
                                type="text" 
                                placeholder="Catatan (Opsional)..."
                                value={note}
                                onChange={(e) => setNote(e.target.value)}
                                className="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 mb-3"
                            />

                            {/* Tombol Numpad */}
                            <div className="grid grid-cols-4 gap-2 mb-4">
                                {[1, 2, 3].map(n => (
                                    <button key={n} onClick={() => handleNumpadClick(n.toString())} className="numpad-btn h-12 bg-white rounded-lg shadow-sm border border-gray-200 text-xl font-semibold text-gray-700 hover:bg-gray-50">{n}</button>
                                ))}
                                <button onClick={handleBackspace} className="numpad-btn h-12 bg-red-50 rounded-lg border border-red-100 text-red-500 flex items-center justify-center"><Icons.Delete size={20}/></button>

                                {[4, 5, 6].map(n => (
                                    <button key={n} onClick={() => handleNumpadClick(n.toString())} className="numpad-btn h-12 bg-white rounded-lg shadow-sm border border-gray-200 text-xl font-semibold text-gray-700 hover:bg-gray-50">{n}</button>
                                ))}
                                <button onClick={() => handleClear()} className="numpad-btn h-12 bg-gray-100 rounded-lg border border-gray-200 text-gray-500 text-sm font-bold">CLR</button>

                                {[7, 8, 9].map(n => (
                                    <button key={n} onClick={() => handleNumpadClick(n.toString())} className="numpad-btn h-12 bg-white rounded-lg shadow-sm border border-gray-200 text-xl font-semibold text-gray-700 hover:bg-gray-50">{n}</button>
                                ))}
                                <button onClick={handleSave} className="row-span-2 h-full bg-indigo-600 rounded-lg shadow-md text-white flex flex-col items-center justify-center active:scale-95 transition-transform">
                                    <Icons.Save size={24} />
                                    <span className="text-[10px] font-bold uppercase mt-1">Simpan</span>
                                </button>

                                <button onClick={() => handleNumpadClick('00')} className="numpad-btn h-12 bg-indigo-50 rounded-lg border border-indigo-100 text-indigo-700 font-bold">00</button>
                                <button onClick={() => handleNumpadClick('0')} className="numpad-btn h-12 bg-white rounded-lg shadow-sm border border-gray-200 text-xl font-semibold text-gray-700">0</button>
                                <button onClick={() => handleNumpadClick('000')} className="numpad-btn h-12 bg-indigo-50 rounded-lg border border-indigo-100 text-indigo-700 font-bold">000</button>
                            </div>
                        </div>

                        {/* List Riwayat Singkat */}
                        <div className="border-t border-gray-200 p-4">
                            <h3 className="text-xs font-bold text-gray-400 uppercase mb-2">Riwayat Terbaru</h3>
                            <div className="space-y-2">
                                {transactions.slice(0, 5).map((t) => (
                                    <div key={t.id} className="flex justify-between items-center bg-white p-2 rounded-lg border border-gray-100 shadow-sm">
                                        <div className="flex items-center gap-2">
                                            <div className={`w-1 h-8 rounded-full ${t.type === 'pemasukan' ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                            <div>
                                                <p className="text-xs font-bold text-gray-700 truncate w-32">{t.note || t.category}</p>
                                                <p className="text-[10px] text-gray-400">{new Date(t.date).toLocaleDateString('id-ID')}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span className={`text-xs font-bold ${t.type === 'pemasukan' ? 'text-green-600' : 'text-red-600'}`}>
                                                {formatRupiah(t.amount)}
                                            </span>
                                            <button onClick={() => handleDelete(t.id)} className="text-gray-300 hover:text-red-500"><Icons.Trash2 size={14}/></button>
                                        </div>
                                    </div>
                                ))}
                                {transactions.length === 0 && <p className="text-center text-xs text-gray-400 py-2">Belum ada transaksi.</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>